{% extends 'base.html' %}
{% block title %}PIP Details{% endblock %}

{% block content %}
<div class="p-6">
  <h1 class="text-2xl font-semibold text-slate-800 mb-6">
    PIP for {{ employee.first_name }} {{ employee.last_name }}
  </h1>

  <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm max-w-3xl space-y-4 text-slate-700">
    <p><span class="font-medium">Status:</span> {{ pip.status }}</p>
    <p><span class="font-medium">Start Date:</span> {{ pip.start_date.strftime('%d %b %Y') }}</p>
    <p><span class="font-medium">Review Date:</span> {{ pip.review_date.strftime('%d %b %Y') }}</p>

    {% if pip.last_updated %}
      <p class="text-sm text-gray-500">
        Last updated: {{ pip.last_updated.strftime('%d %b %Y %H:%M') }}
      </p>
    {% endif %}

    {% if pip.end_date %}
      <p><span class="font-medium">End Date:</span> {{ pip.end_date.strftime('%d %b %Y') }}</p>
    {% endif %}

    <hr class="my-4 border-slate-200">

    <div>
      <p class="font-medium">Concerns:</p>
      <p class="whitespace-pre-line">{{ pip.concerns }}</p>
    </div>

    <div>
      <p class="font-medium mb-2">Action Plan:</p>
      {% if pip.action_items %}
        <table class="min-w-full bg-white text-sm border rounded">
          <thead class="bg-slate-100 text-slate-600 font-semibold">
            <tr>
              <th class="text-left px-4 py-2">Action</th>
              <th class="text-left px-4 py-2">Status</th>
            </tr>
          </thead>
          <tbody>
            {% for item in pip.action_items %}
            <tr class="border-t">
              <td class="px-4 py-2">{{ item.description }}</td>
              <td class="px-4 py-2">
                {% if item.status == 'Completed' %}
                  <span class="text-green-600 font-semibold">✔ Completed</span>
                {% else %}
                  <span class="text-red-600 font-semibold">❗ Outstanding</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="text-slate-500 text-sm">No action items added yet.</p>
      {% endif %}
    </div>

    <div>
      <p class="font-medium">Meeting Notes:</p>
      <p class="whitespace-pre-line">{{ pip.meeting_notes }}</p>
    </div>

    <div>
      <p class="font-medium">Outcome:</p>
      <p class="whitespace-pre-line">{{ pip.outcome or '—' }}</p>
    </div>

    <p class="text-sm text-slate-500">
      Created by {{ pip.created_by }}
      {% if pip.last_updated %}| Last updated {{ pip.last_updated.strftime('%d %b %Y %H:%M') }}{% endif %}
    </p>
  </div>

  <a href="{{ url_for('edit_pip', pip_id=pip.id) }}"
     class="inline-block bg-yellow-500 text-white px-4 py-2 mt-4 rounded-lg hover:bg-yellow-600 transition text-sm">
    ✏️ Edit PIP
  </a>

  <!-- Timeline Section -->
  <h3 class="text-lg font-semibold text-slate-800 mt-8 mb-2">📜 Timeline History</h3>

  <ul class="border border-slate-200 rounded-xl p-4 bg-slate-50 text-slate-700 max-w-3xl space-y-3">
    {% if pip.timeline_events %}
      {% for event in pip.timeline_events|sort(attribute='created_at', reverse=True) %}
        <li class="border-l-4 border-blue-600 pl-4">
          <p class="text-sm text-gray-500">{{ event.created_at.strftime('%d %b %Y %H:%M') }}</p>
          <p class="font-semibold">{{ event.event_type }}</p>
          <p class="text-sm whitespace-pre-line">{{ event.notes }}</p>
        </li>
      {% endfor %}
    {% else %}
      <li class="text-slate-500 text-sm">No timeline events yet.</li>
    {% endif %}
  </ul>
</div>
{% endblock %}
