{% extends 'base.html' %}
{% block title %}PIP for {{ employee.first_name }} {{ employee.last_name }}{% endblock %}

{% block content %}
<div class="flex space-x-6">
  <!-- Main details -->
  <div class="flex-1">
    <div class="max-w-4xl mx-auto px-4 py-6 bg-white shadow rounded-lg space-y-4">
      <h1 class="text-2xl font-bold mb-4">PIP for {{ employee.first_name }} {{ employee.last_name }}</h1>

      <p><strong>Job Title:</strong> {{ employee.job_title }}</p>
      <p><strong>Line Manager:</strong> {{ employee.line_manager }}</p>
      <p><strong>Service:</strong> {{ employee.service }}</p>

      <hr>

      <p><strong>Status:</strong> {{ pip.status }}</p>
      <p><strong>Start Date:</strong> {{ pip.start_date.strftime('%d %b %Y') }}</p>
      <p><strong>Review Date:</strong> {{ pip.review_date.strftime('%d %b %Y') }}</p>
      <p><strong>Concerns:</strong><br>{{ pip.concerns }}</p>
      <p><strong>Meeting Notes:</strong><br>{{ pip.meeting_notes or 'â€”' }}</p>

      <div>
        <strong>Action Plan:</strong>
        {% if pip.action_items %}
          <ul class="list-disc pl-6 mt-2">
            {% for action in pip.action_items %}
              <li>
                {{ action.description }}
                <span class="text-sm text-gray-600">[{{ action.status }}]</span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p>No actions recorded.</p>
        {% endif %}
      </div>

      <div class="pt-4">
        <a href="{{ url_for('edit_pip', id=pip.id) }}"
           class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          Edit PIP
        </a>
        <a href="{{ url_for('employee_detail', employee_id=employee.id) }}"
           class="ml-4 text-blue-600 hover:underline">
          Back to Employee
        </a>
      </div>
    </div>
  </div>

  <!-- Document Generation Actions -->
  <aside class="w-1/4 bg-slate-50 p-4 rounded-lg shadow">
    <h2 class="text-lg font-semibold mb-4">Generate Documents</h2>
    <a href="{{ url_for('generate_invite_letter', id=pip.id) }}"
       class="block mb-2 bg-blue-600 text-white text-center py-2 rounded hover:bg-blue-700">
      Create Invite Letter
    </a>
    <a href="{{ url_for('generate_plan_document', id=pip.id) }}"
       class="block mb-2 bg-green-600 text-white text-center py-2 rounded hover:bg-green-700">
      Create Plan
    </a>
    <a href="{{ url_for('generate_outcome_letter', id=pip.id) }}"
       class="block bg-purple-600 text-white text-center py-2 rounded hover:bg-purple-700">
      Create Outcome Letter
    </a>
  </aside>
</div>
{% endblock %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const addActionButton = document.getElementById('add-action');
    const actionPlanContainer = document.getElementById('action-plan-container');

    addActionButton.addEventListener('click', function(e) {
      e.preventDefault();
      const newActionItem = document.createElement('div');
      newActionItem.className = 'border p-3 rounded mb-3 bg-slate-50 action-item';
      newActionItem.innerHTML = `
        <label class="block text-sm font-medium text-slate-700 mb-1">Action Description</label>
        <input type="text" name="actions[]" class="w-full p-2 border rounded mb-2" placeholder="Describe the action...">
        <label class="block text-sm font-medium text-slate-700 mb-1">Status</label>
        <select name="status[]" class="w-full p-2 border rounded">
          <option value="Not Started">Not Started</option>
          <option value="In Progress">In Progress</option>
          <option value="Completed">Completed</option>
        </select>
        <button type="button" class="remove-action text-red-600 mt-2 text-sm hover:underline">Delete</button>
      `;
      actionPlanContainer.appendChild(newActionItem);
    });

    actionPlanContainer.addEventListener('click', function(e) {
      if (e.target.classList.contains('remove-action')) {
        e.target.closest('.action-item').remove();
      }
    });
  });