<!DOCTYPE html>
<html lang="en">

<style>
  :root{
    --brand-primary:#005b5a;      /* current ellipse teal */
    --brand-primary-600:#004746;
    --brand-bg:#f8fafc;           /* page background */
    --text:#111827;               /* slate-900 */
    --muted:#6b7280;              /* gray-500 */
    --radius:12px;
  }
  html:focus-within { scroll-behavior: smooth; }
  body{ color:var(--text); background:var(--brand-bg); }

  /* Accessible focus ring everywhere (keyboard friendly) */
  :focus-visible{
    outline: 2px solid var(--brand-primary);
    outline-offset: 3px;
    border-radius: 6px;
  }

  /* Reduced motion support for micro-interactions */
  @media (prefers-reduced-motion: reduce){
    *{ animation-duration:0.001ms !important; animation-iteration-count:1 !important; transition-duration:0.001ms !important; scroll-behavior:auto !important; }
  }

  /* Utility buttons with subtle micro-interactions */
  .btn{
    border-radius: var(--radius);
    transition: transform .06s ease, box-shadow .12s ease, background-color .12s ease;
  }
  .btn:hover{ transform: translateY(-1px); }
  .btn:active{ transform: translateY(0); }

  /* Mobile niceties */
  @media (max-width: 640px){
    .actions-row{ flex-direction: column; gap:.5rem; }
    .actions-row > *{ width:100%; }
  }

  /* Stepper: show overflow scroll on small screens */
  .stepper{ overflow-x:auto; -webkit-overflow-scrolling: touch; }
</style>

<!-- Skip to content for keyboard / screen reader users -->
<a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:left-4 focus:top-4 bg-white px-3 py-2 rounded shadow">Skip to content</a>

<head>

  <meta name="csrf-token" content="{{ csrf_token() }}">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Ellipse HR System{% endblock %}</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/tokens.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/ui.css') }}">


  <!-- Google Font + Tailwind + Ellipse config -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['"Open Sans"', 'sans-serif'] },
          colors: {
            ellipse: { teal: '#005b5a', gray: '#404041', light: '#f7f7f7', hover: '#3a8c8b' }
          },
          animation: { 'gradient-x': 'gradient-x 20s ease infinite' },
          keyframes: {
            'gradient-x': {
              '0%, 100%': { backgroundPosition: '0% 50%' },
              '50%': { backgroundPosition: '100% 50%' },
            },
          },
          backgroundImage: { sunset: 'linear-gradient(-45deg, #ff9a9e, #fad0c4, #fbc2eb, #a18cd1)' },
        }
      }
    }
  </script>
</head>

<body class="text-ellipse-gray font-sans overflow-x-hidden {% if layout != 'fullscreen' %}bg-ellipse-light min-h-screen{% endif %}">

{% if layout != 'fullscreen' %}
<div class="flex flex-col md:flex-row min-h-screen">

  {% if active_module %}
  <!-- Mobile Navbar -->
  <div class="md:hidden bg-white shadow p-4 flex justify-between items-center">
    <h1 class="text-lg font-semibold text-ellipse-teal">Ellipse HR</h1>
    <button id="mobileMenuToggle" class="text-ellipse-teal focus:outline-none">â˜°</button>
  </div>

  <!-- Sidebar -->
  <aside id="sidebarMenu" class="w-full md:w-64 bg-white shadow-md hidden md:block">
    <div class="p-6 border-b border-ellipse-light text-center">
      <img src="{{ url_for('static', filename='images/logo.avif') }}" alt="Ellipse HR Logo" class="h-12 w-auto mx-auto mb-3" />
      <h1 class="text-lg font-semibold text-ellipse-teal">Ellipse HR</h1>
    </div>

    <nav class="p-4 space-y-2 text-sm font-medium">
      <a href="{{ url_for('home') }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-ellipse-gray">â¬… Back to Module Selection</a>

      {% if active_module == 'PIP' %}
        <a href="{{ url_for('create_pip_wizard') }}"
           class="block px-4 py-2 rounded hover:bg-ellipse-light text-ellipse-gray {% if request.endpoint == 'create_pip_wizard' %}bg-ellipse-light font-semibold text-ellipse-teal{% endif %}">
          â• Start New PIP (Wizard)
        </a>
        <a href="{{ url_for('employee_list') }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-ellipse-gray">ğŸ‘¥ All Employees</a>
        <a href="{{ url_for('pip_list') }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-ellipse-gray">ğŸ“‹ View All PIPs</a>
        <a href="{{ url_for('dashboard') }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-ellipse-gray">ğŸ“Š Dashboard</a>
      {% elif active_module == 'Probation' %}
        <a href="{{ url_for('create_probation', employee_id=1) }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-ellipse-gray">â• Start Probation</a>
        <a href="{{ url_for('probation_create_wizard') }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-ellipse-gray {% if request.endpoint == 'probation_create_wizard' %}bg-ellipse-light font-semibold text-ellipse-teal{% endif %}">ğŸ§­ Start Probation (Wizard)</a>
        <a href="{{ url_for('probation_employee_list') }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-ellipse-gray">ğŸ‘¥ All Employees</a>
        <a href="{{ url_for('probation_dashboard') }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-ellipse-gray">ğŸ“Š Probation Dashboard</a>
      {% endif %}

      {% if current_user.is_authenticated and current_user.is_superuser() %}
        <div class="mt-4 mb-1 text-xs uppercase tracking-wide text-gray-500 px-4">Admin Tools</div>
        <a href="{{ url_for('admin_dashboard') }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-[#005b5a] {% if request.endpoint == 'admin_dashboard' %}bg-ellipse-light font-semibold{% endif %}">âš™ï¸ Admin Dashboard</a>
        <a href="{{ url_for('employee_import') }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-[#005b5a] {% if request.endpoint == 'employee_import' %}bg-ellipse-light font-semibold{% endif %}">ğŸ“¥ Import Employees</a>
      {% endif %}

      <a href="{{ url_for('logout') }}" class="block px-4 py-2 rounded hover:bg-ellipse-light text-ellipse-gray">ğŸšª Logout</a>
    </nav>
  </aside>
  {% endif %}
{% endif %}

<!-- Main Content -->
<main class="flex-1">
  {% if layout != 'fullscreen' and active_module %}
  <header class="bg-white shadow p-4 flex justify-between items-center border-b border-gray-200">
    <h2 class="text-lg font-semibold text-ellipse-teal">{% block page_title %}{% endblock %}</h2>
    <div class="flex items-center space-x-3 text-sm text-gray-500">
      <span>Logged in as {{ current_user.username }}</span>
      {% if current_user.is_authenticated and current_user.is_superuser() %}
        <a href="{{ url_for('admin_dashboard') }}" class="text-ellipse-teal hover:text-ellipse-hover" title="Admin Tools">âš™ï¸</a>
      {% endif %}
    </div>
  </header>
  {% endif %}

  <div class="{% if layout != 'fullscreen' %}p-4 sm:p-6 max-w-7xl mx-auto{% endif %}">
    {% block content %}{% endblock %}
  </div>
</main>

{% if layout != 'fullscreen' %}
</div>
{% endif %}

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mb-4">
      {% for category, message in messages %}
        <div class="p-3 rounded text-sm text-white bg-{{ 'green-600' if category == 'success' else 'red-600' }}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Mobile Menu Script -->
<script>
  const toggleBtn = document.getElementById('mobileMenuToggle');
  const sidebarMenu = document.getElementById('sidebarMenu');
  if (toggleBtn) {
    toggleBtn.addEventListener('click', () => {
      sidebarMenu.classList.toggle('hidden');
    });
  }
</script>

{% block scripts %}{% endblock %}
</body>
</html>
